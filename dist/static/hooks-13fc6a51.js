import{w as v,r as y,p as S,t as _,D as c,b as p,d as P}from"./PresentationToolGrantsCheck-5cae0952.js";import{r as a}from"./sanity-b2fc26b5.js";const b=n=>n;function R(n,t,u,i=b,e="raw"){if(!t)return n;if(e!=="published"&&e!=="raw"&&e!=="previewDrafts")throw new Error(`Unknown perspective "${e}"`);return v(JSON.parse(JSON.stringify(n)),(r,d)=>{const h=y(d,t);if(!h)return r;const{mapping:f,pathSuffix:E}=h;if(f.type!=="value"||f.source.type!=="documentValue")return r;const s=t.documents[f.source.document],g=t.paths[f.source.path];if(s){const l=S(g+E),m=_(l);if(m==="_id")return r;let o;if(e==="previewDrafts"?(o=u(s._id.startsWith(c)?s:{...s,_id:`${c}${s._id}}`}),o||(o=u(s._id.startsWith(c)?{...s,_id:p(s._id)}:s)),o&&(o={...o,_id:p(s._id),_originalId:s._id})):o=u(s),!o)return r;const w=o?P(o,m,r):r;return r===w?r:i(w,{cachedDocument:o,previousValue:r,sourceDocument:s,sourcePath:l})}return r})}function x(n){const t=a.useMemo(()=>JSON.stringify(n||{}),[n]);return a.useMemo(()=>JSON.parse(t),[t])}function F(n){const{refreshInterval:t}=n,u=L(),[i,e]=a.useState("hit"),r=a.useCallback(()=>(e("inflight"),()=>e("hit")),[]);return a.useEffect(()=>{if(!t||i!=="hit")return;const d=setTimeout(()=>e("stale"),t);return()=>clearTimeout(d)},[t,i]),a.useEffect(()=>{if(i!=="hit")return;const d=()=>e("stale");return window.addEventListener("focus",d),()=>window.removeEventListener("focus",d)},[t,i]),a.useEffect(()=>{u&&i==="hit"&&e("stale"),!u&&i==="stale"&&e("refresh")},[u,i]),[i,r]}function L(){const[n,t]=a.useState(!1);a.useEffect(()=>{t(navigator.onLine);const i=()=>t(!0),e=()=>t(!1);return window.addEventListener("online",i),window.addEventListener("offline",e),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",e)}},[]);const u=a.useSyncExternalStore(D,()=>document.visibilityState,()=>"hidden");return!n||u==="hidden"}function D(n){return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)}export{F as a,R as b,x as u};
