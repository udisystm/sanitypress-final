import{a8 as sr,a9 as ar,b3 as Me,b4 as ir,b5 as rn,b6 as or,r as c,b7 as It,b8 as cr,b9 as sn,ba as Oe,bb as Ve,bc as pe,bd as G,be as ae,bf as ur,aA as Fe,bg as De,bh as an,bi as Je,bj as lr,bk as Ke,bl as dr,bm as pr,bn as hr,bo as fr,aT as on,bp as mr,bq as Qe,br as cn,m as V,j as i,bs as Pe,bt as le,a4 as J,bu as ve,bv as M,K,bw as H,bx as un,J as je,by as Ee,bz as Ye,bA as ln,bB as F,bC as gr,bD as dn,bE as vr,bF as te,bG as pn,bH as U,bI as X,bJ as W,bK as hn,bL as yr,bM as He,N as br,bN as $,bO as Ze,bP as xr,bQ as fn,bR as At,bS as mn,bT as wr,bU as ye,bV as be,bW as Sr,bX as et,bY as Pr,bZ as jr,b_ as Er,b$ as Cr,c0 as gn,c1 as _r,aX as vn,c2 as Rr,c3 as Tr,aa as tt,c4 as yn,c5 as kr,c6 as Ir,c7 as Ar,c8 as Mr,c9 as Or,ca as Mt,an as Dr,cb as $r,cc as zr,cd as Lr,ce as Ur,cf as Nr,cg as Wr,ch as qr,ci as Vr,cj as Fr,ck as Kr,x as Hr,A as Ot,cl as Br,cm as Gr,aV as Xr,cn as nt,co as bn,ai as Jr,cp as Qr,cq as Yr,cr as Zr,aM as es,V as ts,cs as ns,ct as rs,cu as ss,cv as as,cw as is,cx as os,cy as xn,ar as wn,cz as cs,cA as us,cB as ls,az as ds,cC as ps,cD as hs}from"./sanity-b2fc26b5.js";import{i as fs,D as ms}from"./DisplayedDocumentBroadcaster-0bd667e8.js";function gs(e,t){return t===void 0&&(t=null),t=t??e,sr(function(n,r){var a=[],s=0;n.subscribe(ar(r,function(o){var u,d,l,m,p=null;s++%t===0&&a.push([]);try{for(var h=Me(a),g=h.next();!g.done;g=h.next()){var v=g.value;v.push(o),e<=v.length&&(p=p??[],p.push(v))}}catch(P){u={error:P}}finally{try{g&&!g.done&&(d=h.return)&&d.call(h)}finally{if(u)throw u.error}}if(p)try{for(var b=Me(p),w=b.next();!w.done;w=b.next()){var v=w.value;ir(a,v),r.next(v)}}catch(P){l={error:P}}finally{try{w&&!w.done&&(m=b.return)&&m.call(b)}finally{if(l)throw l.error}}},function(){var o,u;try{for(var d=Me(a),l=d.next();!l.done;l=d.next()){var m=l.value;r.next(m)}}catch(p){o={error:p}}finally{try{l&&!l.done&&(u=d.return)&&u.call(d)}finally{if(o)throw o.error}}r.complete()},void 0,function(){a=null}))})}const Dt=new WeakMap;function vs(e){return{config:e,start:(n,r)=>{const{self:a,system:s,emit:o}=r,u={receivers:void 0,dispose:void 0};Dt.set(a,u),u.dispose=e({input:n.input,system:s,self:a,sendBack:d=>{a.getSnapshot().status!=="stopped"&&a._parent&&s._relay(a,a._parent,d)},receive:d=>{u.receivers??(u.receivers=new Set),u.receivers.add(d)},emit:o})},transition:(n,r,a)=>{var o,u;const s=Dt.get(a.self);return r.type===rn?(n={...n,status:"stopped",error:void 0},(o=s.dispose)==null||o.call(s),n):((u=s.receivers)==null||u.forEach(d=>d(r)),n)},getInitialSnapshot:(n,r)=>({status:"active",output:void 0,error:void 0,input:r}),getPersistedSnapshot:n=>n,restoreSnapshot:n=>n}}const $t="xstate.observable.error",zt="xstate.observable.complete";function Sn(e){return{config:e,transition:(n,r)=>{if(n.status!=="active")return n;switch(r.type){case $t:return{...n,status:"error",error:r.data,input:void 0,_subscription:void 0};case zt:return{...n,status:"done",input:void 0,_subscription:void 0};case rn:return n._subscription.unsubscribe(),{...n,status:"stopped",input:void 0,_subscription:void 0};default:return n}},getInitialSnapshot:(n,r)=>({status:"active",output:void 0,error:void 0,context:void 0,input:r,_subscription:void 0}),start:(n,{self:r,system:a,emit:s})=>{n.status!=="done"&&(n._subscription=e({input:n.input,system:a,self:r,emit:s}).subscribe({next:o=>{r._parent&&a._relay(r,r._parent,o)},error:o=>{a._relay(r,r,{type:$t,data:o})},complete:()=>{a._relay(r,r,{type:zt})}}))},getPersistedSnapshot:({_subscription:n,...r})=>r,restoreSnapshot:n=>({...n,_subscription:void 0})}}function ys({children:e,isValidProp:t,...n}){t&&or(t),n={...c.useContext(It),...n},n.isStatic=cr(()=>n.isStatic);const r=c.useMemo(()=>n,[JSON.stringify(n.transition),n.transformPagePoint,n.reducedMotion]);return c.createElement(It.Provider,{value:r},e)}var z=[];for(var $e=0;$e<256;++$e)z.push(($e+256).toString(16).slice(1));function bs(e,t=0){return(z[e[t+0]]+z[e[t+1]]+z[e[t+2]]+z[e[t+3]]+"-"+z[e[t+4]]+z[e[t+5]]+"-"+z[e[t+6]]+z[e[t+7]]+"-"+z[e[t+8]]+z[e[t+9]]+"-"+z[e[t+10]]+z[e[t+11]]+z[e[t+12]]+z[e[t+13]]+z[e[t+14]]+z[e[t+15]]).toLowerCase()}var he,xs=new Uint8Array(16);function ws(){if(!he&&(he=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!he))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return he(xs)}var Ss=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Lt={randomUUID:Ss};function ce(e,t,n){if(Lt.randomUUID&&!t&&!e)return Lt.randomUUID();e=e||{};var r=e.random||(e.rng||ws)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return bs(r)}const Ut=e=>({context:t})=>{const{count:n,include:r,exclude:a,responseType:s="message.received"}=e;return{count:n,domain:t.domain,from:t.connectTo,include:r?Array.isArray(r)?r:[r]:[],exclude:a?Array.isArray(a)?a:[a]:[],responseType:s,target:t.target,to:t.name}},Ps=e=>t=>{const{data:n}=t;return(e.include.length?e.include.includes(n.type):!0)&&(e.exclude.length?!e.exclude.includes(n.type):!0)&&n.domain===e.domain&&n.from===e.from&&n.to===e.to&&(!e.target||t.source===e.target)},js=e=>t=>({type:e,message:t}),Es=hr(()=>Ke(window,"message")),Pn=e=>Sn(({input:t})=>Es.pipe(e?Fe(e):De(),an(Ps(t)),Fe(js(t.responseType)),t.count?De(gs(t.count),lr(n=>n),Je(t.count)):De())),rt="sanity/comlink",Cs=3e3,_s=500,ue="comlink/response",xe="comlink/heartbeat",st="comlink/disconnect",at="comlink/handshake/syn",it="comlink/handshake/syn-ack",ot="comlink/handshake/ack",Rs=e=>t=>t.pipe(Je(1),Fe(()=>{throw new Error(e)})),jn=()=>sn({types:{},actors:{listen:Sn(({input:e})=>{const t=e.signal?Ke(e.signal,"abort").pipe(Rs(`Request ${e.requestId} aborted`)):dr,n=r=>{var a,s;return((a=r.data)==null?void 0:a.type)===ue&&((s=r.data)==null?void 0:s.responseTo)===e.requestId&&!!r.source&&e.sources.has(r.source)};return Ke(window,"message").pipe(an(n),Je(e.sources.size),pr(t))})},actions:{"send message":({context:e},t)=>{const{sources:n,targetOrigin:r}=e,{message:a}=t;n.forEach(s=>{s.postMessage(a,{targetOrigin:r})})},"on success":Oe(({context:e})=>e.parentRef,({context:e,self:t})=>{var n;return e.response&&((n=e.resolvable)==null||n.resolve(e.response)),{type:"request.success",requestId:t.id,response:e.response,responseTo:e.responseTo}}),"on fail":Oe(({context:e})=>e.parentRef,({context:e,self:t})=>{var n;return e.suppressWarnings||console.warn(`[@sanity/comlink] Received no response to message '${e.type}' on client '${e.from}' (ID: '${e.id}').`),(n=e.resolvable)==null||n.reject(new Error("No response received")),{type:"request.failed",requestId:t.id}}),"on abort":Oe(({context:e})=>e.parentRef,({context:e,self:t})=>{var n;return(n=e.resolvable)==null||n.reject(new Error("Request aborted")),{type:"request.aborted",requestId:t.id}})},guards:{expectsResponse:({context:e})=>e.expectResponse},delays:{initialTimeout:0,responseTimeout:({context:e})=>e.responseTimeout??Cs}}).createMachine({context:({input:e})=>({connectionId:e.connectionId,data:e.data,domain:e.domain,expectResponse:e.expectResponse??!1,from:e.from,id:`msg-${ce()}`,parentRef:e.parentRef,resolvable:e.resolvable,response:null,responseTimeout:e.responseTimeout,responseTo:e.responseTo,signal:e.signal,sources:e.sources instanceof Set?e.sources:new Set([e.sources]),suppressWarnings:e.suppressWarnings,targetOrigin:e.targetOrigin,to:e.to,type:e.type}),initial:"idle",on:{abort:".aborted"},states:{idle:{after:{initialTimeout:[{target:"sending"}]}},sending:{entry:{type:"send message",params:({context:e})=>{const{connectionId:t,data:n,domain:r,from:a,id:s,responseTo:o,to:u,type:d}=e;return{message:{connectionId:t,data:n,domain:r,from:a,id:s,to:u,type:d,responseTo:o}}}},always:[{guard:"expectsResponse",target:"awaiting"},"success"]},awaiting:{invoke:{id:"listen for response",src:"listen",input:({context:e})=>({requestId:e.id,sources:e.sources,signal:e.signal}),onError:"aborted"},after:{responseTimeout:"failed"},on:{message:{actions:Ve({response:({event:e})=>e.data.data,responseTo:({event:e})=>e.data.responseTo}),target:"success"}}},failed:{type:"final",entry:"on fail"},success:{type:"final",entry:"on success"},aborted:{type:"final",entry:"on abort"}},output:({context:e,self:t})=>({requestId:t.id,response:e.response,responseTo:e.responseTo})}),Ts=vs(({sendBack:e,input:t})=>{const n=()=>{e(t.event)};t.immediate&&n();const r=setInterval(n,t.interval);return()=>{clearInterval(r)}}),we=()=>sn({types:{},actors:{requestMachine:jn(),listen:Pn(),sendBackAtInterval:Ts},actions:{"buffer message":pe(({enqueue:e})=>{e.assign({buffer:({event:t,context:n})=>(G(t,"post"),[...n.buffer,t.data])}),e.emit(({event:t})=>(G(t,"post"),{type:"_buffer.added",message:t.data}))}),"create request":Ve({requests:({context:e,event:t,self:n,spawn:r})=>{G(t,"request");const a=(Array.isArray(t.data)?t.data:[t.data]).map(s=>{const o=`req-${ce()}`;return r("requestMachine",{id:o,input:{connectionId:e.connectionId,data:s.data,domain:e.domain,expectResponse:s.expectResponse,from:e.name,parentRef:n,responseTo:s.responseTo,sources:e.target,targetOrigin:e.targetOrigin,to:e.connectTo,type:s.type}})});return[...e.requests,...a]}}),"emit received message":pe(({enqueue:e})=>{e.emit(({event:t})=>(G(t,"message.received"),{type:"_message",message:t.message.data})),e.emit(({event:t})=>(G(t,"message.received"),{type:t.message.data.type,message:t.message.data}))}),"flush buffer":pe(({enqueue:e})=>{e.raise(({context:t})=>({type:"request",data:t.buffer.map(({data:n,type:r})=>({data:n,type:r}))})),e.emit(({context:t})=>({type:"_buffer.flushed",messages:t.buffer})),e.assign({buffer:[]})}),post:ae(({event:e})=>(G(e,"post"),{type:"request",data:{data:e.data.data,expectResponse:!0,type:e.data.type}})),"remove request":pe(({context:e,enqueue:t,event:n})=>{G(n,["request.success","request.failed","request.aborted"]),ur(n.requestId),t.assign({requests:e.requests.filter(({id:r})=>r!==n.requestId)})}),respond:ae(({event:e})=>(G(e,"response"),{type:"request",data:{data:e.data,type:ue,responseTo:e.respondTo}})),"send handshake ack":ae({type:"request",data:{type:ot}}),"send disconnect":ae(()=>({type:"request",data:{type:st}})),"send handshake syn":ae({type:"request",data:{type:at}}),"set target":Ve({target:({event:e})=>(G(e,"target.set"),e.target)})},guards:{"has target":({context:e})=>!!e.target,"should send heartbeats":({context:e})=>e.heartbeat}}).createMachine({id:"channel",context:({input:e})=>({id:e.id||`${e.name}-${ce()}`,buffer:[],connectionId:`cnx-${ce()}`,connectTo:e.connectTo,domain:e.domain??rt,heartbeat:e.heartbeat??!1,name:e.name,requests:[],target:e.target,targetOrigin:e.targetOrigin}),on:{"target.set":{actions:"set target"},"request.success":{actions:"remove request"},"request.failed":{actions:"remove request"}},initial:"idle",states:{idle:{on:{connect:{target:"handshaking",guard:"has target"},post:{actions:"buffer message"}}},handshaking:{id:"handshaking",invoke:[{id:"send syn",src:"sendBackAtInterval",input:()=>({event:{type:"syn"},interval:_s,immediate:!0})},{id:"listen for handshake",src:"listen",input:e=>Ut({include:it,count:1})(e)}],on:{syn:{actions:"send handshake syn"},request:{actions:"create request"},post:{actions:"buffer message"},"message.received":{target:"connected"},disconnect:{target:"disconnected"}},exit:"send handshake ack"},connected:{entry:"flush buffer",invoke:{id:"listen for messages",src:"listen",input:Ut({exclude:[ue,xe]})},on:{post:{actions:"post"},request:{actions:"create request"},response:{actions:"respond"},"message.received":{actions:"emit received message"},disconnect:{target:"disconnected"}},initial:"heartbeat",states:{heartbeat:{initial:"checking",states:{checking:{always:{guard:"should send heartbeats",target:"sending"}},sending:{on:{"request.failed":{target:"#handshaking"}},invoke:{id:"send heartbeat",src:"sendBackAtInterval",input:()=>({event:{type:"post",data:{type:xe,data:void 0}},interval:2e3,immediate:!1})}}}}}},disconnected:{id:"disconnected",entry:"send disconnect",on:{request:{actions:"create request"},post:{actions:"buffer message"},connect:{target:"handshaking",guard:"has target"}}}}}),ze=(e,t=we())=>{const n=e.id||`${e.name}-${ce()}`,r=fr(t,{input:{...e,id:n}}),a=(h,g)=>{const{unsubscribe:v}=r.on(h,async b=>{const w=await g(b.message.data);w&&r.send({type:"response",respondTo:b.message.id,data:w})});return v},s=()=>{r.send({type:"connect"})},o=()=>{r.send({type:"disconnect"})},u=h=>{const g=r.getSnapshot();let v=typeof g.value=="string"?g.value:Object.keys(g.value)[0];const{unsubscribe:b}=r.subscribe(w=>{const P=typeof w.value=="string"?w.value:Object.keys(w.value)[0];v!==P&&(v=P,h(P))});return b},d=h=>{r.send({type:"target.set",target:h})},l=h=>{r.send({type:"post",data:h})},m=()=>{r.stop()},p=()=>(r.start(),m);return{actor:r,connect:s,disconnect:o,id:n,name:e.name,machine:t,on:a,onStatus:u,post:l,setTarget:d,start:p,stop:m,get target(){return r.getSnapshot().context.target}}},ks=()=>{},Is=e=>{const{targetOrigin:t}=e,n=new Set,r=new Set,a=o=>{if(n.has(o))return ks;if(!n.size||!r.size)return n.add(o),r.forEach(d=>{d.channels.forEach(l=>{l.setTarget(o),l.connect()})}),()=>{n.delete(o),r.forEach(d=>{d.channels.forEach(l=>{l.target===o&&l.disconnect()})})};n.add(o);const u=new Set;return r.forEach(d=>{const l=ze({...d.input,target:o,targetOrigin:t},d.machine);u.add(l),d.channels.add(l),d.subscribers.forEach(({type:m,handler:p,unsubscribers:h})=>{h.push(l.on(m,p))}),d.internalEventSubscribers.forEach(({type:m,handler:p,unsubscribers:h})=>{h.push(l.actor.on(m,p).unsubscribe)}),d.statusSubscribers.forEach(({handler:m,unsubscribers:p})=>{p.push(l.onStatus(h=>m({channel:l.id,status:h})))}),l.start(),l.connect()}),()=>{n.delete(o),u.forEach(d=>{s(d),r.forEach(l=>{l.channels.delete(d)})})}},s=o=>{o.disconnect(),setTimeout(()=>{o.stop()},0)};return{addTarget:a,createConnection:(o,u=we())=>{const d={channels:new Set,input:o,internalEventSubscribers:new Set,machine:u,statusSubscribers:new Set,subscribers:new Set};r.add(d);const{channels:l,internalEventSubscribers:m,statusSubscribers:p,subscribers:h}=d;if(n.size)n.forEach(y=>{const x=ze({...o,target:y,targetOrigin:t},u);l.add(x)});else{const y=ze({...o,targetOrigin:t},u);l.add(y)}const g=y=>{l.forEach(x=>{x.post(y)})},v=(y,x)=>{const f=[];l.forEach(j=>{f.push(j.on(y,x))});const E={type:y,handler:x,unsubscribers:f};return h.add(E),()=>{f.forEach(j=>j()),h.delete(E)}},b=(y,x)=>{const f=[];l.forEach(j=>{f.push(j.actor.on(y,x).unsubscribe)});const E={type:y,handler:x,unsubscribers:f};return m.add(E),()=>{f.forEach(j=>j()),m.delete(E)}},w=y=>{const x=[];l.forEach(E=>{x.push(E.onStatus(j=>y({channel:E.id,status:j})))});const f={handler:y,unsubscribers:x};return p.add(f),()=>{x.forEach(E=>E()),p.delete(f)}},P=()=>{l.forEach(y=>{s(y)})};return{on:v,onInternalEvent:b,onStatus:w,post:g,start:()=>(l.forEach(y=>{y.start(),y.connect()}),P),stop:P}},destroy:()=>{r.forEach(({channels:o})=>{o.forEach(u=>{s(u),o.delete(u)})})}}},As=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ct=/_key\s*==\s*['"](.*)['"]/,Ms=/^\d*:\d*$/;function ut(e){return typeof e=="number"||typeof e=="string"&&/^\[\d+\]$/.test(e)}function Ce(e){return typeof e=="string"?ct.test(e.trim()):typeof e=="object"&&"_key"in e}function En(e){if(typeof e=="string"&&Ms.test(e))return!0;if(!Array.isArray(e)||e.length!==2)return!1;const[t,n]=e;return(typeof t=="number"||t==="")&&(typeof n=="number"||n==="")}function Os(e,t,n){const r=typeof t=="string"?Cn(t):t;if(!Array.isArray(r))throw new Error("Path must be an array or a string");let a=e;for(let s=0;s<r.length;s++){const o=r[s];if(ut(o)){if(!Array.isArray(a))return n;a=a[o]}if(Ce(o)){if(!Array.isArray(a))return n;a=a.find(u=>u._key===o._key)}if(typeof o=="string"&&(a=typeof a=="object"&&a!==null?a[o]:void 0),typeof a>"u")return n}return a}function Ds(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce((t,n,r)=>{const a=typeof n;if(a==="number")return`${t}[${n}]`;if(a==="string")return`${t}${r===0?"":"."}${n}`;if(Ce(n)&&n._key)return`${t}[_key=="${n._key}"]`;if(Array.isArray(n)){const[s,o]=n;return`${t}[${s}:${o}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(n)}\``)},"")}function Cn(e){if(typeof e!="string")throw new Error("Path is not a string");const t=e.match(As);if(!t)throw new Error("Invalid path string");return t.map($s)}function $s(e){return ut(e)?zs(e):Ce(e)?Ls(e):En(e)?Us(e):e}function zs(e){return Number(e.replace(/[^\d]/g,""))}function Ls(e){return{_key:e.match(ct)[1]}}function Us(e){const[t,n]=e.split(":").map(r=>r===""?r:Number(r));return[t,n]}var _n=Object.freeze({__proto__:null,fromString:Cn,get:Os,isIndexSegment:ut,isIndexTuple:En,isKeySegment:Ce,reKeySegment:ct,toString:Ds});const Nt="drafts.";function Qi(e){return e.startsWith(Nt)?e.slice(Nt.length):e}const Wt={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},qt={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function Ns(e){return`$${e.map(t=>typeof t=="string"?`['${t.replace(/[\f\n\r\t'\\]/g,n=>Wt[n])}']`:typeof t=="number"?`[${t}]`:t._key!==""?`[?(@._key=='${t._key.replace(/['\\]/g,n=>Wt[n])}')]`:`[${t._index}]`).join("")}`}function Yi(e){const t=[],n=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let r;for(;(r=n.exec(e))!==null;){if(r[1]!==void 0){const a=r[1].replace(/\\(\\|f|n|r|t|')/g,s=>qt[s]);t.push(a);continue}if(r[2]!==void 0){t.push(parseInt(r[2],10));continue}if(r[3]!==void 0){const a=r[3].replace(/\\(\\')/g,s=>qt[s]);t.push({_key:a,_index:-1});continue}}return t}function Ws(e){return e.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function Zi(e,t){if(!(t!=null&&t.mappings))return;const n=Ns(Ws(e));if(t.mappings[n]!==void 0)return{mapping:t.mappings[n],matchedPath:n,pathSuffix:""};const r=Object.entries(t.mappings).filter(([u])=>n.startsWith(u)).sort(([u],[d])=>d.length-u.length);if(r.length==0)return;const[a,s]=r[0],o=n.substring(a.length);return{mapping:s,matchedPath:a,pathSuffix:o}}function qs(e){return e!==null&&Array.isArray(e)}function Vt(e){return typeof e=="object"&&e!==null}function ie(e,t,n=[]){if(qs(e))return e.map((r,a)=>{if(Vt(r)){const s=r._key;if(typeof s=="string")return ie(r,t,n.concat({_key:s,_index:a}))}return ie(r,t,n.concat(a))});if(Vt(e)){if(e._type==="block"||e._type==="span"){const r={...e};return e._type==="block"?r.children=ie(e.children,t,n.concat("children")):e._type==="span"&&(r.text=ie(e.text,t,n.concat("text"))),r}return Object.fromEntries(Object.entries(e).map(([r,a])=>[r,ie(a,t,n.concat(r))]))}return t(e,n)}const lt="sanity.previewUrlSecret",Vs="sanity-preview-url-secret",Y=`${Vs}.share-access`,ne="sanity.previewUrlShareAccess",dt="2023-11-09",pt="sanity-preview-secret",ht="sanity-preview-pathname",ft="sanity-preview-perspective",Rn=60*60,Fs=`*[_id == "${Y}" && _type == "${ne}"][0].secret`,Ks=`*[_type == "${lt}" && dateTime(_updatedAt) <= dateTime(now()) - ${Rn}]`,mt="sanity.preview-url-secret";function Hs(e){const t=new URL(e),{searchParams:n}=t;return n.delete(ht),n.delete(pt),n.delete(ft),t}function Bs(e,t,n,r){const a=new URL(e),{searchParams:s}=a;return s.set(pt,t),s.set(ht,n),s.set(ft,r),a}function Tn(){if(typeof crypto<"u"){const e=new Uint8Array(16);crypto.getRandomValues(e);let t="";for(let n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t=btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]+$/,""),t}return Math.random().toString(36).slice(2)}async function Gs(e,t,n,r){const a=e.withConfig({apiVersion:dt}),s=Tn(),o=a.patch(Y).set({secret:s,studioUrl:n,userId:r});return await a.transaction().createIfNotExists({_id:Y,_type:ne,source:t,studioUrl:n,userId:r}).patch(o).commit({tag:mt}),{secret:s}}async function Xs(e,t,n,r){const a=e.withConfig({apiVersion:dt}),s=a.patch(Y).set({secret:null,studioUrl:n,userId:r});await a.transaction().createIfNotExists({_id:Y,_type:ne,source:t,studioUrl:n,userId:r}).patch(s).commit({tag:mt})}function Js(e){for(var t=[],n=0;n<e.length;){var r=e[n];if(r==="*"||r==="+"||r==="?"){t.push({type:"MODIFIER",index:n,value:e[n++]});continue}if(r==="\\"){t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});continue}if(r==="{"){t.push({type:"OPEN",index:n,value:e[n++]});continue}if(r==="}"){t.push({type:"CLOSE",index:n,value:e[n++]});continue}if(r===":"){for(var a="",s=n+1;s<e.length;){var o=e.charCodeAt(s);if(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||o===95){a+=e[s++];continue}break}if(!a)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:a}),n=s;continue}if(r==="("){var u=1,d="",s=n+1;if(e[s]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<e.length;){if(e[s]==="\\"){d+=e[s++]+e[s++];continue}if(e[s]===")"){if(u--,u===0){s++;break}}else if(e[s]==="("&&(u++,e[s+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(s));d+=e[s++]}if(u)throw new TypeError("Unbalanced pattern at ".concat(n));if(!d)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:d}),n=s;continue}t.push({type:"CHAR",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}function Qs(e,t){t===void 0&&(t={});for(var n=Js(e),r=t.prefixes,a=r===void 0?"./":r,s=t.delimiter,o=s===void 0?"/#?":s,u=[],d=0,l=0,m="",p=function(S){if(l<n.length&&n[l].type===S)return n[l++].value},h=function(S){var C=p(S);if(C!==void 0)return C;var A=n[l],T=A.type,q=A.index;throw new TypeError("Unexpected ".concat(T," at ").concat(q,", expected ").concat(S))},g=function(){for(var S="",C;C=p("CHAR")||p("ESCAPED_CHAR");)S+=C;return S},v=function(S){for(var C=0,A=o;C<A.length;C++){var T=A[C];if(S.indexOf(T)>-1)return!0}return!1},b=function(S){var C=u[u.length-1],A=S||(C&&typeof C=="string"?C:"");if(C&&!A)throw new TypeError('Must have text between two parameters, missing text after "'.concat(C.name,'"'));return!A||v(A)?"[^".concat(Q(o),"]+?"):"(?:(?!".concat(Q(A),")[^").concat(Q(o),"])+?")};l<n.length;){var w=p("CHAR"),P=p("NAME"),y=p("PATTERN");if(P||y){var x=w||"";a.indexOf(x)===-1&&(m+=x,x=""),m&&(u.push(m),m=""),u.push({name:P||d++,prefix:x,suffix:"",pattern:y||b(x),modifier:p("MODIFIER")||""});continue}var f=w||p("ESCAPED_CHAR");if(f){m+=f;continue}m&&(u.push(m),m="");var E=p("OPEN");if(E){var x=g(),j=p("NAME")||"",R=p("PATTERN")||"",O=g();h("CLOSE"),u.push({name:j||(R?d++:""),pattern:j&&!R?b(x):R,prefix:x,suffix:O,modifier:p("MODIFIER")||""});continue}h("END")}return u}function Ys(e,t){var n=[],r=In(e,n,t);return Zs(r,n,t)}function Zs(e,t,n){n===void 0&&(n={});var r=n.decode,a=r===void 0?function(s){return s}:r;return function(s){var o=e.exec(s);if(!o)return!1;for(var u=o[0],d=o.index,l=Object.create(null),m=function(h){if(o[h]===void 0)return"continue";var g=t[h-1];g.modifier==="*"||g.modifier==="+"?l[g.name]=o[h].split(g.prefix+g.suffix).map(function(v){return a(v,g)}):l[g.name]=a(o[h],g)},p=1;p<o.length;p++)m(p);return{path:u,index:d,params:l}}}function Q(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function kn(e){return e&&e.sensitive?"":"i"}function ea(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,a=n.exec(e.source);a;)t.push({name:a[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),a=n.exec(e.source);return e}function ta(e,t,n){var r=e.map(function(a){return In(a,t,n).source});return new RegExp("(?:".concat(r.join("|"),")"),kn(n))}function na(e,t,n){return ra(Qs(e,n),t,n)}function ra(e,t,n){n===void 0&&(n={});for(var r=n.strict,a=r===void 0?!1:r,s=n.start,o=s===void 0?!0:s,u=n.end,d=u===void 0?!0:u,l=n.encode,m=l===void 0?function(C){return C}:l,p=n.delimiter,h=p===void 0?"/#?":p,g=n.endsWith,v=g===void 0?"":g,b="[".concat(Q(v),"]|$"),w="[".concat(Q(h),"]"),P=o?"^":"",y=0,x=e;y<x.length;y++){var f=x[y];if(typeof f=="string")P+=Q(m(f));else{var E=Q(m(f.prefix)),j=Q(m(f.suffix));if(f.pattern)if(t&&t.push(f),E||j)if(f.modifier==="+"||f.modifier==="*"){var R=f.modifier==="*"?"?":"";P+="(?:".concat(E,"((?:").concat(f.pattern,")(?:").concat(j).concat(E,"(?:").concat(f.pattern,"))*)").concat(j,")").concat(R)}else P+="(?:".concat(E,"(").concat(f.pattern,")").concat(j,")").concat(f.modifier);else{if(f.modifier==="+"||f.modifier==="*")throw new TypeError('Can not repeat "'.concat(f.name,'" without a prefix and suffix'));P+="(".concat(f.pattern,")").concat(f.modifier)}else P+="(?:".concat(E).concat(j,")").concat(f.modifier)}}if(d)a||(P+="".concat(w,"?")),P+=n.endsWith?"(?=".concat(b,")"):"$";else{var O=e[e.length-1],S=typeof O=="string"?w.indexOf(O[O.length-1])>-1:O===void 0;a||(P+="(?:".concat(w,"(?=").concat(b,"))?")),S||(P+="(?=".concat(w,"|").concat(b,")"))}return new RegExp(P,kn(n))}function In(e,t,n){return e instanceof RegExp?ea(e,t):Array.isArray(e)?ta(e,t,n):na(e,t,n)}async function sa(e,t,n,r,a=on()){const s=e.withConfig({apiVersion:dt});try{const o=new Date(Date.now()+1e3*Rn),u=`drafts.${a}`,d=Tn(),l=s.patch(u).set({secret:d,source:t,studioUrl:n,userId:r});return await s.transaction().createOrReplace({_id:u,_type:lt}).patch(l).commit({tag:mt}),{secret:d,expiresAt:o}}finally{try{await s.delete({query:Ks})}catch(o){console.error("Failed to delete expired secrets",o)}}}function aa(e){const{draftMode:t,previewMode:n,origin:r=typeof location>"u"?"https://localhost":location.origin}=e,a=(n==null?void 0:n.enable)||(t==null?void 0:t.enable);let{preview:s="/"}=e;const o=new URL(s,r),u=a?new URL(a,r):void 0;return async d=>{try{if(d.previewSearchParam){const m=new URL(d.previewSearchParam,o);m.origin===o.origin&&(s=`${m.pathname}${m.search}`)}}catch{}typeof location<"u"&&location.origin===o.origin&&d.studioBasePath&&(s.startsWith(`${d.studioBasePath}/`)||s===d.studioBasePath)&&(s=e.preview||"/");const l=new URL(s,o);if(u){const m=new URL(u),{searchParams:p}=m;return p.set(pt,d.previewUrlSecret),p.set(ft,d.studioPreviewPerspective),l.pathname!==m.pathname&&p.set(ht,`${l.pathname}${l.search}`),m.toString()}return l.toString()}}const ia=e=>typeof e=="object"&&typeof e.then=="function",fe=[];function oa(e,t,n=(r,a)=>r===a){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let a=0;a<r;a++)if(!n(e[a],t[a]))return!1;return!0}function ca(e,t=null,n=!1,r={}){t===null&&(t=[e]);for(const s of fe)if(oa(t,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const a={keys:t,equal:r.equal,remove:()=>{const s=fe.indexOf(a);s!==-1&&fe.splice(s,1)},promise:(ia(e)?e:e(...t)).then(s=>{a.response=s,r.lifespan&&r.lifespan>0&&(a.timeout=setTimeout(a.remove,r.lifespan))}).catch(s=>a.error=s)};if(fe.push(a),!n)throw a.promise}const An=(e,t,n)=>ca(e,t,!1,n),ua=/^([\w-]+):(0|[1-9][0-9]*)$/,la=/^([\w-]+):([0-9]+),([0-9]+)$/,da=/^([\w-]+):([\w-]+)$/;function pa(e){const t=[];for(const n of e.split(".")){const r=ua.exec(n);if(r){t.push(r[1],Number(r[2]));continue}const a=la.exec(n);if(a){t.push(a[1],[Number(a[2]),Number(a[3])]);continue}const s=da.exec(n);if(s){t.push(s[1],{_key:s[2]});continue}t.push(n)}return t}const re=mr(et(),Sr(1)),oe=Qe(re);cn({baseUrl:re,dataset:oe,id:re,path:re,projectId:oe,tool:oe,type:oe,workspace:oe,isDraft:Qe(et())});cn({origin:re,href:re,data:Qe(Pr(et(),_r()))});const ha={"handshake/syn":at,"handshake/syn-ack":it,"handshake/ack":ot,"channel/response":ue,"channel/heartbeat":xe,"channel/disconnect":st,"overlay/focus":"visual-editing/focus","overlay/navigate":"visual-editing/navigate","overlay/toggle":"visual-editing/toggle","presentation/toggleOverlay":"presentation/toggle-overlay"},fa={[at]:"handshake/syn",[it]:"handshake/syn-ack",[ot]:"handshake/ack",[ue]:"channel/response",[xe]:"channel/heartbeat",[st]:"channel/disconnect","visual-editing/focus":"overlay/focus","visual-editing/navigate":"overlay/navigate","visual-editing/toggle":"overlay/toggle","presentation/toggle-overlay":"presentation/toggleOverlay"},ma=e=>{const{data:t}=e;return t&&typeof t=="object"&&"domain"in t&&"type"in t&&"from"in t&&"to"in t&&(t.domain==="sanity/channels"&&(t.domain=rt),t.to==="overlays"&&(t.to="visual-editing"),t.from==="overlays"&&(t.from="visual-editing"),t.type=ha[t.type]??t.type),e},ga=e=>(e.domain===rt&&(e.domain="sanity/channels"),e.to==="visual-editing"&&(e.to="overlays"),e.from==="visual-editing"&&(e.from="overlays"),e.type=fa[e.type]??e.type,e.type==="channel/response"&&e.responseTo&&!e.data&&(e.data={responseTo:e.responseTo}),(e.type==="handshake/syn"||e.type==="handshake/syn-ack"||e.type==="handshake/ack")&&(e.data={id:e.connectionId}),e),va=({context:e},t)=>{const{sources:n,targetOrigin:r}=e,a=ga(t.message);n.forEach(s=>{s.postMessage(a,{targetOrigin:r})})},Be=()=>({listen:Pn(ma),requestMachine:jn().provide({actions:{"send message":va}})});function ya(e,t){return`${e}-${typeof t=="string"?t:JSON.stringify(t)}`}const ba=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),Ft={alt:"altKey",ctrl:"ctrlKey",mod:ba?"metaKey":"ctrlKey",shift:"shiftKey"};function xa(e,t){return e.every(n=>Ft[n]?t[Ft[n]]:t.key===n.toUpperCase())}function Kt(e){return e.key==="Alt"}function Mn(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(e,r)},t)}}const wa=function(e){const{comlink:t,children:n}=e,r=c.useRef({});c.useEffect(()=>t==null?void 0:t.on("visual-editing/shared-state",()=>({state:r.current})),[t]);const a=c.useCallback((u,d)=>{r.current[u]=d,t==null||t.post({type:"presentation/shared-state",data:{key:u,value:d}})},[t]),s=c.useCallback(u=>{t==null||t.post({type:"presentation/shared-state",data:{key:u}}),delete r.current[u]},[t]),o=c.useMemo(()=>({removeValue:s,setValue:a}),[s,a]);return i.jsx(Ur.Provider,{value:o,children:n})},_e=c.createContext(null);_e.displayName="PanelsContext";const Sa=V.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,gt=function({children:e,defaultSize:t=null,id:n,minWidth:r,maxWidth:a,order:s=0}){const o=c.useContext(_e);if(o===null)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:u,registerElement:d,unregisterElement:l}=o,m=u(n);return c.useLayoutEffect(()=>(d(n,{id:n,type:"panel",defaultSize:t,maxWidth:a??null,minWidth:r??0,order:s}),()=>{l(n)}),[n,t,s,a,r,d,l]),i.jsx(Sa,{style:m,children:e})},On="presentation/panels",Ht=()=>JSON.parse(localStorage.getItem(On)||"{}"),Pa=e=>{localStorage.setItem(On,JSON.stringify(e))},Bt=e=>e.map(t=>[t.id,t.order].join(":")).join(",");function ja(){return c.useMemo(()=>{const e=r=>{const a=Ht(),s=Bt(r);return Array.isArray(a[s])&&a[s].some(o=>o===null)?void 0:a[s]},t=(r,a)=>{const s=Ht(),o=Bt(r),u={...s,[o]:a};Pa(u)},n=Mn(t,100);return{get:e,set:t,setDebounced:n}},[])}function Ge(e,t,n){const{maxWidth:r,minWidth:a}=e,s=r==null?100:r/n*100,o=a/n*100;return Math.min(s,Math.max(o,t))}function Ea(e,t,n,r,a,s){const{panels:o,widths:u}=a,{widths:d}=s,l=d||u,m=[...l];{const v=e<0?r:n,b=o.findIndex(y=>y.id===v.id),w=l[b],P=Ge(v,w+Math.abs(e),t);if(w===P)return l;e=e<0?w-P:P-w}let p=0,h=e<0?n:r,g=o.findIndex(v=>v.id===h.id);for(;;){const v=o[g],b=l[g],w=Math.abs(e)-Math.abs(p),P=Ge(v,b-w,t);if(b!==P&&(p+=b-P,m[g]=P,p.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--g<0)break}else if(++g>=o.length)break}return p===0?l:(h=e<0?r:n,g=o.findIndex(v=>v.id===h.id),m[g]=l[g]+p,m)}function Ca(e,t,n){if(e.length===1)return"100";const r=e.findIndex(s=>s.id===t),a=n[r];return a==null?"0":a.toPrecision(10)}function Gt(e,t,n=0,r=null){const a=e.clientX,s=(r||t.getBoundingClientRect()).left;return a-s-n}function Le(e){return e.type==="panel"}function Xt(e){return e.type==="resizer"}function Jt(e){return Array.from(e.values()).sort(({order:t},{order:n})=>t==null&&n==null?0:t==null?-1:n==null?1:t-n)}function Qt(e,t,n){const r=t.reduce((o,u)=>o+u,0),a=[...t].map(o=>o/r*100);let s=0;for(let o=0;o<e.length;o++){const u=e[o],d=a[o],l=Ge(u,d,n);d!=l&&(s+=d-l,a[o]=l)}if(s.toFixed(3)!=="0.000")for(let o=0;o<e.length;o++){const u=e[o];let{maxWidth:d,minWidth:l}=u;l=l/n*100,d!=null&&(d=d/n*100);const m=Math.min(d??100,Math.max(l,a[o]+s));if(m!==a[o]&&(s-=m-a[o],a[o]=m,Math.abs(s).toFixed(3)==="0.000"))break}return a}function _a(e){let t=e.length,n=100;const r=e.map(s=>s.defaultSize?(n=n-s.defaultSize,t=t-1,s.defaultSize):null),a=n/t;return r.map(s=>s===null?a:s)}const Ra=V.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Ta=function({children:e}){const t=c.useRef(null),[n,r]=c.useState(new Map),a=c.useMemo(()=>Jt(n).filter(Le),[n]),[s,o]=c.useState([]),[u,d]=c.useState(null),l=c.useRef({elements:n,panels:a,widths:s}),m=c.useCallback(x=>({flexGrow:Ca(a,x,s),pointerEvents:u===null?void 0:"none"}),[u,a,s]),p=c.useCallback((x,f)=>{r(E=>{if(E.has(x))return E;const j=new Map(E);return j.set(x,f),j})},[]),h=c.useCallback(x=>{r(f=>{if(!f.has(x))return f;const E=new Map(f);return E.delete(x),E})},[]),g=c.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=c.useCallback((x,f)=>{const E=Jt(n),j=E.findIndex(S=>S.id===x),R=n.get(x);if(!R||!Xt(R))return;const O=R.el.current;O&&(g.current={resizerIndex:j,panelBefore:E.reduce((S,C,A)=>Le(C)&&A<j?C:S,null),panelAfter:E.reduce((S,C,A)=>S===null&&Le(C)&&A>j?C:S,null),containerWidth:window.innerWidth,startX:f.pageX,dragOffset:Gt(f,O),resizerRect:O.getBoundingClientRect(),widths:l.current.widths},d(x))},[n]),b=c.useCallback(()=>{d(null)},[]),w=c.useCallback((x,f)=>{f.preventDefault(),f.stopPropagation();const{containerWidth:E,dragOffset:j,panelBefore:R,panelAfter:O,resizerRect:S}=g.current;if(R==null||O==null)return;const C=n.get(x);if(!C||!Xt(C))return;const A=C.el.current;if(!A)return;const T=Gt(f,A,j,S);if(T===0)return;const{widths:q}=l.current,D=t.current.getBoundingClientRect(),N=T/D.width*100,ee=Ea(N,E,R,O,l.current,g.current);q.some((B,Z)=>B!==ee[Z])&&o(ee)},[n]);c.useLayoutEffect(()=>{l.current.elements=n,l.current.panels=a,l.current.widths=s},[n,a,s]);const P=ja();c.useLayoutEffect(()=>{const{widths:x}=l.current;if(x.length===a.length)return;const f=P.get(a);if(f){const j=Qt(a,f,window.innerWidth);o(j);return}const E=_a(a);o(E)},[P,a]),c.useEffect(()=>{s.length&&P.setDebounced(a,s)},[P,a,s]),c.useLayoutEffect(()=>{const x=new ResizeObserver(()=>{const{panels:f,widths:E}=l.current,j=Qt(f,E,window.innerWidth);E.some((R,O)=>R!==j[O])&&o(j)});return x.observe(t.current),()=>{x.disconnect()}},[]);const y=c.useMemo(()=>({activeResizer:u,drag:w,getPanelStyle:m,registerElement:p,startDragging:v,stopDragging:b,unregisterElement:h}),[u,w,m,p,v,b,h]);return i.jsx(_e.Provider,{value:y,children:i.jsx(Ra,{ref:t,children:e})})};function vt(e){const{children:t,message:n,onRetry:r,onContinueAnyway:a,...s}=e,{t:o}=K(H),u=i.jsx(F,{fontSize:1,mode:"ghost",onClick:r,text:o("error-card.retry-button.text")}),d=i.jsx(F,{fontSize:1,mode:"ghost",tone:"critical",onClick:a,text:o("error-card.continue-button.text")});return i.jsx(W,{height:"fill",...s,children:i.jsx($,{align:"center",height:"fill",justify:"center",children:i.jsx(jr,{padding:4,sizing:"border",width:0,children:i.jsxs(X,{space:4,children:[i.jsxs(X,{space:3,children:[i.jsx(M,{size:1,weight:"semibold",children:o("error-card.title")}),i.jsx(M,{muted:!0,size:1,children:n})]}),t,r&&a?i.jsxs(Er,{space:2,children:[u,d]}):r?i.jsx(U,{children:u}):a?i.jsx(U,{children:d}):null]})})})})}function ka(e={}){const t=Object.entries(e).map(([n,r])=>`${n}=${r}`).join("&");return t.length?`?${t}`:""}function Ia(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"],n=Object.entries(e).filter(([r])=>t.includes(r)).reduce((r,[a,s])=>s==null?r:{...r,[a]:s},{});return ka(n)}const Aa=c.forwardRef(function(e,t){const{searchParams:n,...r}=e;return i.jsx(Pe,{...r,ref:t,state:{type:void 0,_searchParams:Object.entries(n)},title:void 0})}),Ma=c.forwardRef(function(e,t){const{documentId:n,documentType:r,parentRefPath:a,template:s,searchParams:o,...u}=e;return i.jsx(Pe,{...u,ref:t,state:{id:n,type:r,_searchParams:Object.entries(o)},title:void 0})});function Dn(e){const{children:t,onStructureParams:n,structureParams:r,searchParams:a,refs:s}=e,{state:o,resolvePathFromState:u}=tt(),d=yn(Object.fromEntries(o._searchParams||[])),l=c.useCallback(p=>{const h=u(o),g=Ia({...d,...p});return`${h}${g}`},[u,d,o]),m=c.useMemo(()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:r,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:p=>{const{childId:h,...g}=p,v=s==null?void 0:s.find(b=>b._id===h||nt(b._id)===h);return v?i.jsx(Pe,{...g,state:{id:h,type:v._type,_searchParams:Object.entries(a)}}):i.jsx("div",{...g})},BackLink:p=>i.jsx(Aa,{...p,searchParams:a}),ReferenceChildLink:p=>i.jsx(Ma,{...p,searchParams:a}),ParameterizedLink:()=>i.jsx(i.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:p=>{console.warn("handleEditReference",p)},replaceCurrent:p=>{console.warn("replaceCurrent",p)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:p=>{console.warn("duplicateCurrent",p)},setView:p=>{console.warn("setView",p)},setParams:p=>{n({...p,inspect:p.inspect??void 0})},setPayload:p=>{console.warn("setPayload",p)},navigateIntent:(p,h,g)=>{console.warn("navigateIntent",p,h,g)},createPathWithParams:l}),[l,n,s,a,r]);return i.jsx(ds.Provider,{value:m,children:t})}const Oa=V(vn)`
  height: 100%;
`,Da=V($)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,$a=V(be)`
  white-space: pre-wrap;
`;function za(e){const{mainDocumentState:t,onStructureParams:n,searchParams:r,refs:a}=e,{t:s}=K(H),{devMode:o}=Ze(),u=c.useMemo(()=>a.filter(g=>{var v;return nt(g._id)!==((v=t==null?void 0:t.document)==null?void 0:v._id)}).map(g=>g._id),[t,a]),d=c.useMemo(()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:u}},schemaTypeName:"",title:s("document-list-pane.document-list.title"),type:"documentList"}),[u,s]),[l,m]=c.useState(null),p=c.useCallback(()=>m(null),[]),[h]=c.useState(()=>({}));return c.useEffect(()=>m(null),[a]),l?i.jsx(vt,{flex:1,message:s("document-list-pane.error.text"),onRetry:p,children:o&&i.jsx(W,{overflow:"auto",padding:3,radius:2,tone:"critical",children:i.jsxs(X,{space:3,children:[i.jsx(ye,{muted:!0,size:0,children:s("presentation-error.label")}),i.jsx($a,{size:1,children:l.error.message})]})})}):i.jsx(xn,{onCatch:m,children:i.jsx(Oa,{children:i.jsx(wn,{children:i.jsx(Dn,{onStructureParams:n,structureParams:h,searchParams:r,refs:a,children:i.jsx(Da,{direction:"column",flex:1,children:i.jsx(cs,{index:0,itemId:"$root",pane:d,paneKey:"$root"})})})})})})}const La=V(be)`
  white-space: pre-wrap;
`;function Ua(e){const{documentId:t,documentType:n,onFocusPath:r,onStructureParams:a,searchParams:s,structureParams:o}=e,{template:u,templateParams:d}=o,{t:l}=K(H),{devMode:m}=Ze(),p=c.useMemo(()=>({id:t,options:{id:t,type:n,template:u,templateParameters:ps(d)},title:"",type:"document"}),[t,n,u,d]),[h,g]=c.useState(null),v=c.useCallback(()=>g(null),[]);return c.useEffect(()=>{g(null)},[t,n,o]),h?i.jsx(vt,{flex:1,message:l("document-pane.error.text"),onRetry:v,children:m&&i.jsx(W,{overflow:"auto",padding:3,radius:2,tone:"critical",children:i.jsxs(X,{space:3,children:[i.jsx(ye,{muted:!0,size:0,children:l("presentation-error.label")}),i.jsx(La,{size:1,children:h.error.message})]})})}):i.jsx(xn,{onCatch:g,children:i.jsx(vn,{style:{height:"100%"},children:i.jsx(Dn,{searchParams:s,onStructureParams:a,structureParams:o,children:i.jsx(c.Suspense,{fallback:i.jsx(gn,{}),children:i.jsx(hs,{paneKey:"document",index:1,itemId:"document",pane:p,onFocusPath:r})})})})})}function Na(e){const{documentId:t,documentType:n,onFocusPath:r,onStructureParams:a,searchParams:s,structureParams:o}=e;return i.jsx(wn,{children:i.jsx(Ua,{documentId:t,documentType:n,onFocusPath:r,onStructureParams:a,searchParams:s,structureParams:o})})}function Wa(e,t){const n=us(),[r,a]=c.useState({});return c.useEffect(()=>{if(!t)return;const s=ls(n,t,e,"").subscribe(o=>{a(o)});return()=>{s==null||s.unsubscribe()}},[n,t,e]),r}function qa(e){var b;const{documentId:t,documentType:n,mainDocumentState:r,onFocusPath:a,onStructureParams:s,refs:o,searchParams:u,structureParams:d}=e,{t:l}=K(H),m=Jr(),p=c.useCallback(w=>i.jsx(Pe,{...w,state:{id:r.document._id,type:r.document._type,_searchParams:Object.entries(u)}}),[r,u]),h=c.useMemo(()=>{var w;return m.get(((w=r==null?void 0:r.document)==null?void 0:w._type)||"shoe")},[r,m]),g=Wa(((b=r==null?void 0:r.document)==null?void 0:b._id)||"",h),v=c.useMemo(()=>r!=null&&r.document?i.jsx(Qr,{...Yr({value:r.document,published:g.published,draft:g.draft}),schemaType:h,status:i.jsx(W,{padding:1,radius:2,shadow:1,children:i.jsx(M,{muted:!0,size:0,weight:"medium",children:l("main-document.label")})})}):null,[r,h,l,g]);return t&&n?i.jsx(Na,{documentId:t,documentType:n,onFocusPath:a,onStructureParams:s,searchParams:u,structureParams:d}):i.jsxs($,{direction:"column",flex:1,height:"fill",children:[r&&i.jsx(W,{padding:3,tone:r.document?"inherit":"caution",children:r.document?i.jsx(Zr,{__unstable_focusRing:!0,as:p,"data-as":"a",radius:2,sizing:"border",tone:"inherit",children:v}):i.jsx(W,{padding:2,radius:2,tone:"inherit",children:i.jsxs($,{gap:3,children:[i.jsx(U,{flex:"none",children:i.jsx(M,{size:1,children:i.jsx(es,{})})}),i.jsx(U,{flex:1,children:i.jsx(M,{size:1,children:i.jsx(ts,{t:l,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:r.path}})})})]})})}),i.jsx(za,{mainDocumentState:r,onStructureParams:s,searchParams:u,refs:o})]})}var L=[];for(var Ue=0;Ue<256;++Ue)L.push((Ue+256).toString(16).slice(1));function Va(e,t=0){return(L[e[t+0]]+L[e[t+1]]+L[e[t+2]]+L[e[t+3]]+"-"+L[e[t+4]]+L[e[t+5]]+"-"+L[e[t+6]]+L[e[t+7]]+"-"+L[e[t+8]]+L[e[t+9]]+"-"+L[e[t+10]]+L[e[t+11]]+L[e[t+12]]+L[e[t+13]]+L[e[t+14]]+L[e[t+15]]).toLowerCase()}var me,Fa=new Uint8Array(16);function Ka(){if(!me&&(me=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!me))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return me(Fa)}var Ha=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yt={randomUUID:Ha};function Ba(e,t,n){if(Yt.randomUUID&&!t&&!e)return Yt.randomUUID();e=e||{};var r=e.random||(e.rng||Ka)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Va(r)}function Ga(e){return c.useRef(e||Ba()).current}const Xa=V.div`
  position: relative;
`,Ja=V.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&`
    /* Hover effect */
    & > span:nth-child(2) {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 9px;
      bottom: 0;
      background-color: var(--card-border-color);
      opacity: 0;
      transition: opacity 150ms;
    }

    @media (hover: hover) {
      &:hover > span:nth-child(2) {
        opacity: 0.2;
      }
    }
  `}
`,$n=function({id:e,order:t,disabled:n=!1}){const r=c.useRef(null),a=c.useContext(_e);if(a===null)throw Error("Panel components must be rendered within a PanelGroup container");const s=Ga(e),{activeResizer:o,drag:u,startDragging:d,stopDragging:l,registerElement:m,unregisterElement:p}=a,h=o===s;if(a===null)throw Error("Panel components must be rendered within a PanelGroup container");const g=c.useCallback(w=>{d(s,w.nativeEvent)},[s,d]),v=c.useCallback(w=>{u(s,w)},[s,u]),b=c.useCallback(()=>{r.current.blur(),l()},[l]);return c.useEffect(()=>{if(!h||n)return;function w(){const y=document.body.style,x=document.documentElement.style,{cursor:f}=x,{userSelect:E}=y;return x.cursor="ew-resize",y.userSelect="none",()=>{f?x.cursor=f:x.removeProperty("cursor"),E?y.userSelect=E:y.removeProperty("user-select")}}const P=w();return window.addEventListener("mousemove",v),window.addEventListener("mouseup",b),window.addEventListener("contextmenu",b),()=>{P(),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",b),window.removeEventListener("contextmenu",b)}},[n,h,v,b]),c.useLayoutEffect(()=>(m(s,{id:s,order:t,type:"resizer",el:r}),()=>{p(s)}),[s,t,m,p]),i.jsx(Xa,{onMouseDown:g,ref:r,children:i.jsxs(Ja,{$disabled:n,children:[i.jsx("span",{}),i.jsx("span",{})]})})},Qa=e=>{const{documentId:t,setDisplayedDocument:n,getCommentIntent:r}=e;return i.jsxs(i.Fragment,{children:[i.jsx($n,{order:4}),i.jsx(gt,{id:"content",minWidth:325,order:5,children:i.jsx(ms,{documentId:t,setDisplayedDocument:n,children:i.jsx(ns,{getIntent:r,children:e.children})})})]})},Ya=e=>{const{documentId:t,documentsOnPage:n,documentType:r,getCommentIntent:a,mainDocumentState:s,onFocusPath:o,onStructureParams:u,searchParams:d,setDisplayedDocument:l,structureParams:m}=e;return i.jsx(Qa,{documentId:t,getCommentIntent:a,setDisplayedDocument:l,children:i.jsx(qa,{documentId:t,documentType:r,mainDocumentState:s,onFocusPath:o,onStructureParams:u,refs:n,searchParams:d,structureParams:m})})},Za=function(e){const{children:t,navigate:n}=e,r=c.useCallback((a,s=void 0)=>{n(s||{},a?{preview:a}:{})},[n]);return i.jsx(Nr.Provider,{value:r,children:t})};function ei(e,t){const[n,r]=c.useState(()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t)));return c.useEffect(()=>{localStorage.setItem(e,JSON.stringify(n))},[e,n]),[n,r]}function ti(e){const{unstable_navigator:t}=e,n=!!(t!=null&&t.component),[r,a]=ei("presentation/navigator",n),s=n?r:!1,o=c.useMemo(()=>{if(n)return()=>a(d=>!d)},[n,a]),u=c.useCallback(function(){return i.jsx(i.Fragment,{children:s&&i.jsx(ri,{...t})})},[s,t]);return[{navigatorEnabled:s,toggleNavigator:o},u]}function ni(e){const{minWidth:t,maxWidth:n,component:r}=e,a=t!=null&&n!=null&&t===n;return i.jsxs(i.Fragment,{children:[i.jsx(gt,{id:"navigator",minWidth:t,maxWidth:n,order:1,children:i.jsx(r,{})}),i.jsx($n,{order:2,disabled:a})]})}const ri=c.memo(ni),si=function(e){const{children:t,params:n}=e,r=c.useMemo(()=>n,[n]);return i.jsx(Wr.Provider,{value:r,children:t})},ai=function(e){const{children:t,devMode:n,name:r,navigate:a,params:s,searchParams:o,structureParams:u}=e,d=c.useMemo(()=>({devMode:n,name:r,navigate:a,params:s,searchParams:o,structureParams:u}),[n,r,a,s,o,u]);return i.jsx(qr.Provider,{value:d,children:t})},ii=le(V.iframe`
  box-shadow: 0 0 0 1px var(--card-border-color);
  border-top: 1px solid transparent;
  border-bottom: 0;
  border-right: 0;
  border-left: 0;
  max-height: 100%;
  width: 100%;
`),oi=V(U)`
  position: absolute;
  inset: 0;
  background: transparent;
`,ci=c.forwardRef(function(e,t){const{animate:n,initial:r,onLoad:a,preventClick:s,src:o,variants:u}=e;return i.jsxs(i.Fragment,{children:[i.jsx(ii,{animate:n,initial:r,onLoad:a,ref:t,src:o,variants:u}),s&&i.jsx(oi,{})]})});function ui(e){const{openPopup:t,previewLocationOrigin:n,previewLocationRoute:r}=e,{t:a}=K(H),s=c.useCallback(o=>{o.preventDefault(),t(o.currentTarget.href)},[t]);return i.jsx(te,{animate:!0,content:i.jsx(M,{size:1,children:a("share-url.menu-item.open.text")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:i.jsx(F,{as:"a","aria-label":a("share-url.menu-item.open.text"),fontSize:1,icon:rs,mode:"bleed",padding:2,href:`${n}${r}`,onClick:s,rel:"opener",target:"_blank"})})}const li=function(e){var x;const{fontSize:t=1,onChange:n,origin:r,padding:a=3,prefix:s,suffix:o,value:u}=e,{t:d}=K(H),{basePath:l="/"}=((x=bn())==null?void 0:x.activeWorkspace)||{},m=c.useRef(null),[p,h]=c.useState(void 0),[g,v]=c.useState(void 0),b=c.useCallback(f=>{h(f.currentTarget.value)},[]),w=c.useCallback(f=>{var E;if(f.key==="Enter"){if(p===void 0)return;const j=p.startsWith("/")||p===""?`${r}${p}`:p;if(!j.startsWith(r+"/")&&j!==r){v(d("preview-location-input.error",{origin:r,context:"missing-origin"}));return}if(!r&&(j.startsWith(`${l}/`)||j===l)){v(d("preview-location-input.error",{basePath:l,context:"same-base-path"}));return}const R=j===r?r+"/":j;v(void 0),h(void 0),n(R.slice(r.length)),(E=m.current)==null||E.blur()}f.key==="Escape"&&(v(void 0),h(void 0))},[l,n,r,p,d]),P=c.useCallback(()=>{v(void 0),h(void 0)},[]);c.useEffect(()=>{v(void 0),h(void 0)},[r,u]);const y=c.useMemo(()=>({icon:ss}),[]);return i.jsx(i.Fragment,{children:i.jsx(as,{clearButton:g?y:void 0,customValidity:g,fontSize:t,onBlur:P,onClear:()=>{v(void 0),h(r+u)},onChange:b,onKeyDownCapture:w,padding:a,prefix:s,style:{zIndex:1},radius:2,ref:m,space:a,suffix:o,value:p===void 0?`${r}${u}`:p})})},di=c.lazy(()=>J(()=>import("./QRCodeSVG-b8e816c6.js"),["static/QRCodeSVG-b8e816c6.js","static/sanity-b2fc26b5.js"])),Xe=24,pi=16,hi=224,fi=V(Rr)`
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: ${Xe}px;
  width: ${Xe}px;
`,mi=le(ve),gi=le(M),vi=le(fi),zn=c.memo(function(e){const{canToggleSharePreviewAccess:t,canUseSharedPreviewAccess:n,initialUrl:r,previewLocationRoute:a,perspective:s}=e,{t:o}=K(H),{push:u}=un(),d=je({apiVersion:Ee}),l=Ye(),[m,p]=c.useState(!0),[h,g]=c.useState(!1),[v,b]=c.useState(!1),[w,P]=c.useState(null),y=h||v||m,x=c.useMemo(()=>w?Bs(r,w,a,s):null,[r,s,a,w]),[f,E]=c.useState(null);if(f)throw f;const j=c.useCallback(()=>{u({closable:!0,status:"warning",title:o("share-preview-menu.error_toggle-sharing",{context:"toggle-sharing"})})},[u,o]),R=c.useCallback(async()=>{try{b(!0),await Xs(d,"@sanity/presentation",typeof window>"u"?"":location.href,l==null?void 0:l.id),P(null)}catch(C){E(C)}finally{b(!1)}},[d,l==null?void 0:l.id]),O=c.useCallback(async()=>{try{g(!0);const C=await Gs(d,"@sanity/presentation",typeof window>"u"?"":location.href,l==null?void 0:l.id);P(C.secret)}catch(C){E(C)}finally{g(!1)}},[d,l==null?void 0:l.id]),S=c.useCallback(()=>{try{if(!x)throw new Error("No URL to copy");navigator.clipboard.writeText(x.toString()),u({closable:!0,status:"success",title:o("share-url.clipboard.status",{context:"success"})})}catch(C){E(C)}},[u,o,x]);return c.useEffect(()=>{let C=new AbortController,A=[];async function T(D,N){const{result:ee,syncTags:B}=await d.fetch(Fs,{},{filterResponse:!1,lastLiveEventId:D,tag:"presentation.fetch-shared-access-secret"});Array.isArray(B)&&(A=B),N.aborted||P(ee)}const q=d.live.events().subscribe({next:D=>{D.type==="message"&&(C.abort(),C=new AbortController,D.tags.some(N=>A.includes(N))&&T(D.id,C.signal))},error:E});return T(null,C.signal).finally(()=>p(!1)),()=>{q.unsubscribe(),C.abort()}},[d]),i.jsx(ln,{button:i.jsx(F,{"aria-label":o("preview-frame.share-button.aria-label"),fontSize:1,icon:gr,mode:"bleed",padding:2}),id:"share-menu",menu:i.jsx(dn,{style:{maxWidth:248},padding:n?void 0:0,children:n?i.jsxs(i.Fragment,{children:[i.jsx("label",{style:{cursor:"pointer"},children:i.jsxs(vr,{columns:2,rows:2,gapX:3,gapY:1,style:{justifyContent:"center",alignItems:"center",gridTemplateColumns:"min-content 1fr",gridTemplateRows:"min-content"},paddingTop:3,paddingX:3,children:[i.jsx(te,{animate:!0,content:i.jsx(M,{size:1,children:o("share-preview-menu.toggle-button.tooltip",{context:x?"disable":"enable"})}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:i.jsx(pn,{checked:h||x!==null&&!v,readOnly:h||v,indeterminate:m,onChange:t?x?R:O:j})}),i.jsx(M,{size:1,weight:"medium",children:o("share-preview-menu.toggle-button.label",{context:"first-line"})}),i.jsx("span",{}),i.jsx(M,{muted:!0,size:1,children:o("share-preview-menu.toggle-button.label",{context:"second-line"})})]})}),i.jsx(U,{padding:3,paddingTop:2,children:i.jsxs(X,{space:3,children:[i.jsx(W,{tone:y||!x?"transparent":void 0,style:{position:"relative",aspectRatio:"1 / 1",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(hn,{children:y?i.jsx(mi,{muted:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}):x?i.jsx(i.Fragment,{children:i.jsxs(c.Suspense,{fallback:i.jsx(ve,{}),children:[i.jsx(di,{title:o("share-preview-menu.qr-code.title",{url:x.toString()}),value:x.toString(),size:hi,color:"var(--card-fg-color)",logoSize:Xe+pi}),i.jsx(vi,{initial:{opacity:-.5},animate:{opacity:1.5},exit:{opacity:0}})]})}):i.jsx(gi,{muted:!0,size:1,style:{maxWidth:"100px",textWrap:"pretty",textAlign:"center"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:o("share-preview-menu.qr-code.placeholder")})})}),i.jsx(M,{muted:!0,size:1,children:o("share-preview-menu.qr-code.instructions")})]})}),i.jsx(yr,{}),i.jsx(He,{disabled:!x||v,icon:br,onClick:S,fontSize:1,padding:3,text:o("share-preview-menu.copy-url.text")})]}):i.jsx(W,{padding:2,tone:"caution",radius:3,children:i.jsx(M,{style:{textWrap:"pretty"},children:o("share-preview-menu.error",{context:"missing-grants"})})})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})});zn.displayName="Memo(SharePreviewMenu)";const Ne={previewDrafts:"preview-frame.perspective.previewDrafts.title",published:"preview-frame.perspective.published.title"},Zt={previewDrafts:"caution",published:"positive"},en={previewDrafts:is,published:os},yi=e=>{const{canSharePreviewAccess:t,canToggleSharePreviewAccess:n,canUseSharedPreviewAccess:r,dispatch:a,iframe:s,iframeRef:o,initialUrl:u,loadersConnection:d,navigatorEnabled:l,onPathChange:m,onRefresh:p,openPopup:h,overlaysConnection:g,perspective:v,previewUrl:b,setPerspective:w,setViewport:P,targetOrigin:y,toggleNavigator:x,toggleOverlay:f,viewport:E,visualEditing:{overlaysEnabled:j}}=e,{t:R}=K(H),O=c.useCallback(()=>P(E==="desktop"?"mobile":"desktop"),[P,E]),S=c.useMemo(()=>y===location.origin?"":y,[y]),C=c.useCallback(()=>{p(()=>{o.current&&(a({type:fn}),o.current.src=`${y}${b||"/"}`)})},[a,p,b,y,o]),A=c.useMemo(()=>{const T=new URL(b||"/",y),{pathname:q,search:D}=Hs(T);return`${q}${D}`},[b,y]);return i.jsxs(i.Fragment,{children:[x&&i.jsx(U,{flex:"none",marginRight:1,padding:1,children:i.jsx(te,{animate:!0,content:i.jsx(M,{size:1,children:R("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:i.jsx(F,{"aria-label":R("preview-frame.navigator.toggle-button.aria-label"),fontSize:1,icon:Vr,mode:"bleed",onClick:x,padding:2,selected:l})})}),i.jsx(te,{animate:!0,content:i.jsxs($,{align:"center",style:{whiteSpace:"nowrap"},children:[i.jsx(U,{padding:1,children:i.jsx(M,{size:1,children:R("preview-frame.overlay.toggle-button.tooltip",{context:j?"disable":"enable"})})}),i.jsx(U,{paddingY:1,children:i.jsx(Fr,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:i.jsx(W,{as:"label",flex:"none",marginRight:1,padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:j?"transparent":void 0,children:i.jsxs($,{align:"center",gap:3,children:[i.jsx("div",{style:{margin:-4},children:i.jsx(pn,{checked:j,onChange:f,disabled:s.status==="loading"||g!=="connected"})}),i.jsx(U,{children:i.jsx(M,{muted:!j,size:1,weight:"medium",children:R("preview-frame.overlay.toggle-button.text")})})]})})}),i.jsx(U,{flex:1,marginX:1,children:i.jsx(li,{prefix:i.jsx(U,{padding:1,children:i.jsx(te,{animate:!0,content:i.jsx(M,{size:1,children:s.status==="loaded"?R("preview-frame.refresh-button.tooltip"):R("preview-frame.status",{context:s.status})}),fallbackPlacements:["bottom-end"],padding:2,placement:"bottom",portal:!0,children:i.jsx(F,{"aria-label":R("preview-frame.refresh-button.aria-label"),fontSize:1,icon:Kr,mode:"bleed",loading:s.status==="reloading"||s.status==="refreshing",onClick:C,padding:2})})}),onChange:m,origin:S,suffix:i.jsx(U,{padding:1,children:i.jsx(ui,{openPopup:h,previewLocationOrigin:S,previewLocationRoute:A})}),value:A})}),i.jsx($,{align:"center",flex:"none",gap:1,padding:1,children:i.jsx(ln,{button:i.jsx(F,{fontSize:1,iconRight:Hr,mode:"bleed",padding:2,space:2,text:R(Ne[d==="connected"?v:"previewDrafts"]),loading:d==="reconnecting"&&s.status!=="loaded",disabled:d!=="connected"}),id:"perspective-menu",menu:i.jsxs(dn,{style:{maxWidth:240},children:[i.jsx(He,{fontSize:1,onClick:()=>w("previewDrafts"),padding:3,pressed:v==="previewDrafts",tone:Zt.previewDrafts,children:i.jsxs($,{align:"flex-start",gap:3,children:[i.jsx(U,{flex:"none",children:i.jsx(M,{size:1,children:c.createElement(en.previewDrafts)})}),i.jsxs(X,{flex:1,space:2,children:[i.jsx(M,{size:1,weight:"medium",children:R(Ne.previewDrafts)}),i.jsx(M,{muted:!0,size:1,children:R("preview-frame.perspective.previewDrafts.text")})]}),i.jsx(U,{flex:"none",children:i.jsx(M,{muted:!0,size:1,style:{opacity:v==="previewDrafts"?1:0},children:i.jsx(Ot,{})})})]})}),i.jsx(He,{fontSize:1,onClick:()=>w("published"),padding:3,pressed:v==="published",tone:Zt.published,children:i.jsxs($,{align:"flex-start",gap:3,children:[i.jsx(U,{flex:"none",children:i.jsx(M,{size:1,children:c.createElement(en.published)})}),i.jsxs(X,{flex:1,space:2,children:[i.jsx(M,{size:1,weight:"medium",children:R(Ne.published)}),i.jsx(M,{muted:!0,size:1,children:R("preview-frame.perspective.published.text")})]}),i.jsx(U,{flex:"none",children:i.jsx(M,{muted:!0,size:1,style:{opacity:v==="published"?1:0},children:i.jsx(Ot,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),i.jsx($,{align:"center",flex:"none",gap:1,children:i.jsx(te,{animate:!0,content:i.jsx(M,{size:1,children:R("preview-frame.viewport-button.tooltip",{context:E==="desktop"?"narrow":"full"})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:i.jsx(F,{"aria-label":R("preview-frame.viewport-button.aria-label"),fontSize:1,icon:E==="desktop"?Br:Gr,mode:"bleed",onClick:O,padding:2})})}),t&&i.jsx($,{align:"center",flex:"none",gap:1,paddingX:1,children:i.jsx(zn,{canToggleSharePreviewAccess:n,canUseSharedPreviewAccess:r,previewLocationRoute:A,initialUrl:u,perspective:v})})]})},bi=e=>{var r;const t=c.useCallback(a=>c.createElement(yi,a),[]),n=(r=e.options)!=null&&r.component?c.createElement(e.options.component,{...e,renderDefault:t}):t(e);return i.jsx(W,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:i.jsx($,{align:"center",style:{minHeight:0},children:n})})};function xi(e){return c.useCallback(()=>i.jsx(bi,{...e}),[e])}const We=le($),Ln=c.memo(c.forwardRef(function(e,t){const{dispatch:n,iframe:r,header:a,initialUrl:s,loadersConnection:o,overlaysConnection:u,viewport:d}=e,{t:l}=K(H),{devMode:m}=Ze(),p=xr(),h=c.useRef(null),g=xi({...e,iframeRef:h,options:a});c.useImperativeHandle(t,()=>h.current);const v=r.status==="loading"||r.status==="reloading",[b,w]=c.useState(!1),P=r.status==="refreshing",[y,x]=c.useState(!1),f=v||P||u==="connecting",E=c.useCallback(()=>{h.current&&(h.current.src=s.toString(),n({type:fn}))},[n,s]),j=c.useCallback(()=>{O(!0)},[]),[R,O]=c.useState(!1),[S,C]=c.useState(!1);c.useEffect(()=>{if(!(v||P)&&(u==="connecting"||u==="reconnecting")){const D=setTimeout(()=>{C(!0)},5e3);return()=>clearTimeout(D)}},[u,v,P]),c.useEffect(()=>{if(!(v||P||!S)){if(u==="connected"&&(x(!1),C(!1),w(!1),O(!1)),u==="connecting"){const D=setTimeout(()=>{w(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")},At);return()=>clearTimeout(D)}if(u==="reconnecting"){const D=setTimeout(()=>{w(!0),x(!0)},At);return()=>clearTimeout(D)}u==="disconnected"&&x(!0)}},[v,u,P,S]);const A=c.useCallback(()=>{n({type:mn})},[n]);c.useEffect(()=>{if(!h.current)return;const D=h.current;function N(){D===document.activeElement&&D.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))}return window.addEventListener("blur",N),()=>{window.removeEventListener("blur",N)}},[]);const T=c.useMemo(()=>(v||u==="connecting"&&r.status!=="refreshing")&&!R,[R,r.status,v,u]),q=c.useMemo(()=>[T?"background":"active",v?"reloading":"idle",d,S&&!R?"timedOut":""],[R,v,T,S,d]);return i.jsx(ys,{transition:p?{duration:0}:void 0,children:i.jsxs(wr,{delay:1e3,children:[i.jsx(g,{}),i.jsx(W,{flex:1,tone:"transparent",children:i.jsxs($,{align:"center",height:"fill",justify:"center",padding:d==="desktop"?0:2,sizing:"border",style:{position:"relative",cursor:f?"wait":void 0},children:[i.jsx(hn,{children:!y&&!v&&!P&&S&&!R?i.jsx(We,{initial:"initial",animate:"animate",exit:"exit",variants:tn,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:b?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:b?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:i.jsxs($,{style:{...Se[d]},justify:"center",align:"center",direction:"column",gap:4,children:[b&&i.jsx(F,{disabled:!0,fontSize:1,mode:"ghost",text:l("preview-frame.continue-button.text"),style:{opacity:0}}),i.jsx(W,{radius:2,tone:b?"caution":"inherit",padding:4,shadow:1,children:i.jsxs($,{justify:"center",align:"center",direction:"column",gap:4,children:[i.jsx(ve,{muted:!0}),i.jsx(M,{muted:!0,size:1,children:b?l("preview-frame.status",{context:"timeout"}):l("preview-frame.status",{context:"connecting"})})]})}),b&&i.jsx(F,{fontSize:1,tone:"critical",onClick:j,text:l("preview-frame.continue-button.text")})]})}):(v||u==="connecting"&&r.status!=="refreshing")&&!R?i.jsx(We,{initial:"initial",animate:"animate",exit:"exit",variants:tn,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:i.jsxs($,{style:{...Se[d]},justify:"center",align:"center",direction:"column",gap:4,children:[i.jsx(ve,{muted:!0}),i.jsx(M,{muted:!0,size:1,children:l("preview-frame.status",{context:"loading"})})]})}):y&&!R?i.jsx(We,{initial:"initial",animate:"animate",exit:"exit",variants:wi,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:i.jsx(vt,{flex:1,message:l("preview-frame.connection.error.text"),onRetry:E,onContinueAnyway:j,children:m&&i.jsxs(i.Fragment,{children:[u!=="connected"&&i.jsx(W,{padding:3,radius:2,tone:"critical",children:i.jsxs(X,{space:3,children:[i.jsx(ye,{muted:!0,size:0,children:l("preview-frame.overlay.connection-status.label")}),i.jsx(be,{size:1,children:l("channel.status",{context:u})})]})}),o!=="connected"&&i.jsx(W,{padding:3,radius:2,tone:"critical",children:i.jsxs(X,{space:3,children:[i.jsx(ye,{muted:!0,size:0,children:l("preview-frame.loader.connection-status.label")}),i.jsx(be,{size:1,children:l("channel.status",{context:o})})]})})]})})}):null}),i.jsx(ci,{animate:q,initial:["background"],onLoad:A,preventClick:T,ref:h,src:s.toString(),variants:Si})]})})]})})}));Ln.displayName="Memo(ForwardRef(Preview))";const Se={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},tn={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},wi={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Si={desktop:{...Se.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Se.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function Pi(e,t,n,r,a){const s=c.useRef(r),o=c.useCallback(t,n);c.useEffect(()=>{const u=s.current;if(s.current=e,e!==u)return o(e,u)},[o,a,e])}const ji=function(e){const{documentId:t,documentType:n,navigate:r,perspective:a,documentRevision:s}=e,o=Xr(t,n);return Pi(a,u=>{let d;if(u==="published"&&o.published){const{_updatedAt:l,_rev:m}=o.published;d=`${l}/${m}`}s!==d&&r({},{rev:d},!0)},[o,r,s]),null};let nn=!1;function Ei(e,t){if(e!=="published"&&e!=="previewDrafts")throw new Error(`Invalid perspective: ${e}`);const[n,r]=c.useState({}),[a,s]=c.useState({}),o=c.useRef(""),u=c.useCallback((d,l,m=[])=>{const p=m.filter(h=>"_projectId"in h&&h._projectId?(nn||(console.warn("Cross dataset references are not supported yet, ignoring source document",h),nn=!0),!1):h);(l==="published"?r:s)(h=>{const g={};for(const b of p)g[b._id]=b;if(o.current!==t.current.url)return o.current=t.current.url,{[d]:g};const v=h[d];return fs(v,g)?h:{...h,[d]:g}})},[t]);return[c.useMemo(()=>{const d=Object.values(e==="published"?n:a).reduce((l,m)=>(Object.values(m).forEach(p=>{l[p._id]=p}),l),{});return Object.values(d)},[e,a,n]),u]}function Un(e,t){return e instanceof Function?e(t):e}function Ci(e,t){var n;if(e.resolve){const r=(n=e.resolve(t))==null?void 0:n.filter;return r?`*[${r}][0]{_id, _type}`:void 0}return"type"in e?`*[_type == "${e.type}"][0]{_id, _type}`:`*[${Un(e.filter,t)}][0]{_id, _type}`}function _i(e,t){var n;return e.resolve?((n=e.resolve(t))==null?void 0:n.params)??t.params:"type"in e?{}:Un(e.params,t)??t.params}function Ri(e,t){const n=Array.isArray(e)?e:[e];for(e of n){let r,a=e;if(typeof e=="string")try{const s=new URL(e);r=s.origin,a=s.pathname}catch{}if(!(r&&t.origin!==r))try{const s=Ys(a,{decode:decodeURIComponent})(t.pathname);if(s){const{params:o,path:u}=s;return{origin:r,params:o,path:u}}}catch{throw new Error(`"${e}" is not a valid route pattern`)}}}function Ti(e){const{navigate:t,navigationHistory:n,path:r,previewUrl:a,resolvers:s=[]}=e,{state:o}=tt(),u=je({apiVersion:Ee}),[d,l]=c.useState(void 0),m=c.useRef(void 0),p=c.useMemo(()=>{var b,w;const g=r||((w=(b=o._searchParams)==null?void 0:b.find(([P])=>P==="preview"))==null?void 0:w[1])||"",v=typeof a=="string"?a:typeof a=="object"&&(a==null?void 0:a.origin)||location.origin;return new URL(g,v)},[r,a,o._searchParams]),h=c.useCallback(()=>{l(void 0),m.current=void 0},[]);return c.useEffect(()=>{if(s.length&&p){let g;for(const v of s){const b=Ri(v.route,p);if(b){g={context:b,resolver:v};break}}if(g){const v=Ci(g.resolver,g.context),b=_i(g.resolver,g.context);if(v){const w=new AbortController,P={perspective:"previewDrafts",signal:w.signal};return u.fetch(v,b,P).then(y=>{var x,f;(!y||m.current!==y._id)&&(l({document:y,path:p.pathname}),m.current=y==null?void 0:y._id,((x=n.at(-1))==null?void 0:x.id)===((f=n.at(-2))==null?void 0:f.id)&&(t==null||t({id:y==null?void 0:y._id,type:y==null?void 0:y._type})))}).catch(y=>{y instanceof Error&&y.name==="AbortError"||(l({document:void 0,path:p.pathname}),m.current=void 0)}),()=>{w.abort()}}}}h()},[u,h,t,n,s,p]),d}function ki(e){var n;if(e===void 0)return;const t=(n=decodeURIComponent(e))==null?void 0:n.split(".");return t[0]==="drafts"&&t.shift(),t.join(".")}function Ii(e){if(e!==void 0)return _n.toString(pa(decodeURIComponent(e)))}function Ai(e){return{id:ki(e.id),path:Ii(e.path),type:e.type}}function ge(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0&&t!==""&&t!==null))}function Mi({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r,frameStateRef:a}){const s=c.useMemo(()=>{const{id:p,path:h,type:g}=Ai(n);return{id:p,type:g,path:h,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,viewport:r.viewport,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,templateParams:r.templateParams,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}},[n,r,e]),o=c.useMemo(()=>ge({inspect:s.inspect,path:s.path,rev:s.rev,since:s.since,template:s.template,templateParams:s.templateParams,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment}),[s.comment,s.inspect,s.instruction,s.path,s.pathKey,s.rev,s.since,s.template,s.templateParams,s.view]),u=c.useMemo(()=>ge({perspective:s.perspective,preview:s.preview,viewport:s.viewport}),[s.perspective,s.preview,s.viewport]),d=c.useRef(n);c.useEffect(()=>{d.current=n},[n]);const[l,m]=c.useState([n]);return{navigate:c.useCallback((p,h={},g)=>{p.id&&(p.id=nt(p.id));const{_searchParams:v,...b}=d.current,w=(v||[]).reduce((f,[E,j])=>(f[E]=j,f),{}),P=ge({...b,...p}),y=ge({...w,...h});b.id!==P.id&&(delete y.template,delete y.templateParams),P._searchParams=Object.entries(y).reduce((f,[E,j])=>[...f,[E,j]],[]);const x=g??y.preview===a.current.url;m(f=>[...f,P]),t(P,{replace:x})},[t,a]),navigationHistory:l,params:s,searchParams:u,structureParams:o}}function Oi(e,t,n,r,a){var p,h;const s=je({apiVersion:Ee}),o=bn(),u=((p=o==null?void 0:o.activeWorkspace)==null?void 0:p.basePath)||"/",d=((h=o==null?void 0:o.activeWorkspace)==null?void 0:h.name)||"default",l=$i(t,u,d,r),m=zi(a&&typeof e=="object"||typeof e=="function",l);return An(async()=>{if(typeof e=="string"){const v=new URL(e,location.origin);let b=v;try{if(r){const w=new URL(r,v);w.origin===v.origin&&(b=w)}}catch{}return location.origin===b.origin&&(b.pathname.startsWith(`${u}/`)||b.pathname===u)?v:b}const g=await(typeof e=="object"?aa(e):e)({client:s,previewUrlSecret:m,studioPreviewPerspective:n,previewSearchParam:r,studioBasePath:u});return new URL(g,location.origin)},[...l,m])}const Di=Symbol();function $i(e,t,n,r){const[a,s]=c.useState(()=>r||""),o=c.useRef(0);c.useEffect(()=>{if(a&&r)return window.clearTimeout(o.current),()=>{o.current=window.setTimeout(()=>{s("")},100)}},[a,r]);const u=Ye();return c.useMemo(()=>["@sanity/presentation",t,n,e,u==null?void 0:u.id,Di,a],[t,u==null?void 0:u.id,e,n,a])}function zi(e,t){const n=je({apiVersion:Ee}),r=Ye(),[a,s]=c.useState(""),o=e?An(async()=>await sa(n,"@sanity/presentation",typeof window>"u"?"":location.href,r==null?void 0:r.id),[...t,a]):null;return c.useEffect(()=>{if(!o)return;const u=setTimeout(()=>{c.startTransition(()=>s(o.expiresAt.toString()))},o.expiresAt.getTime()-Date.now());return()=>clearTimeout(u)},[o]),(o==null?void 0:o.secret)||null}function qe(){const[e,t]=c.useState(new Map),n=c.useMemo(()=>{const a=Array.from(e.values()),s=a.filter(({status:o})=>o==="handshaking");return s.length?s.some(({hasConnected:o})=>!o)?"connecting":"reconnecting":a.find(({status:o})=>o==="connected")?"connected":"idle"},[e]),r=c.useCallback(a=>{t(s=>{var u;const o=new Map(s);if(a.status==="disconnected")o.delete(a.channel);else{const d=((u=o.get(a.channel))==null?void 0:u.hasConnected)||a.status==="connected";o.set(a.channel,{status:a.status,hasConnected:d})}return o})},[]);return[n,r]}const Li=c.lazy(()=>J(()=>import("./LoaderQueries-69d802be.js"),["static/LoaderQueries-69d802be.js","static/sanity-b2fc26b5.js","static/hooks-13fc6a51.js","static/DisplayedDocumentBroadcaster-0bd667e8.js"]));c.lazy(()=>J(()=>import("./LiveQueries-4e3ee38d.js"),["static/LiveQueries-4e3ee38d.js","static/sanity-b2fc26b5.js","static/hooks-13fc6a51.js","static/DisplayedDocumentBroadcaster-0bd667e8.js"]));const Ui=c.lazy(()=>J(()=>import("./PostMessageDocuments-567f2697.js"),["static/PostMessageDocuments-567f2697.js","static/sanity-b2fc26b5.js"])),Ni=c.lazy(()=>J(()=>import("./PostMessageFeatures-292b726c.js"),["static/PostMessageFeatures-292b726c.js","static/sanity-b2fc26b5.js"])),Wi=c.lazy(()=>J(()=>import("./PostMessageRefreshMutations-c3c8e24f.js"),["static/PostMessageRefreshMutations-c3c8e24f.js","static/sanity-b2fc26b5.js"])),qi=c.lazy(()=>J(()=>import("./PostMessagePerspective-61859632.js"),["static/PostMessagePerspective-61859632.js","static/sanity-b2fc26b5.js"])),Vi=c.lazy(()=>J(()=>import("./PostMessagePreviewSnapshots-fd4e7d36.js"),["static/PostMessagePreviewSnapshots-fd4e7d36.js","static/sanity-b2fc26b5.js"])),Fi=c.lazy(()=>J(()=>import("./PostMessageSchema-cd1aeec3.js"),["static/PostMessageSchema-cd1aeec3.js","static/sanity-b2fc26b5.js"])),Ki=V($)`
  overflow-x: auto;
`;function Hi(e){var Ct,_t,Rt,Tt,kt;const{canCreateUrlPreviewSecrets:t,canToggleSharePreviewAccess:n,canUseSharedPreviewAccess:r,tool:a}=e,s=(Ct=a.options)==null?void 0:Ct.components,o=(_t=a.options)==null?void 0:_t.previewUrl,u=a.name||Tr,{unstable_navigator:d,unstable_header:l}=s||{},{navigate:m,state:p}=tt(),h=yn(Object.fromEntries(p._searchParams||[])),g=Oi(o||"/",u,h.perspective==="published"?"published":"previewDrafts",h.preview||null,t),v=c.useMemo(()=>o&&typeof o=="object"&&"draftMode"in o&&o.draftMode?(console.warn("previewUrl.draftMode is deprecated, use previewUrl.previewMode instead"),o.draftMode.shareAccess!==!1):o&&typeof o=="object"&&"previewMode"in o&&o.previewMode?o.previewMode.shareAccess!==!1:!1,[o]),[b]=c.useState(()=>{var k;const _=(k=a.options)==null?void 0:k.devMode;return typeof _=="function"?_():typeof _=="boolean"?_:typeof window<"u"&&window.location.hostname==="localhost"}),w=c.useMemo(()=>g.origin,[g.origin]),P=c.useRef(null),[y,x]=c.useState(),[f,E]=c.useState(null),j=c.useRef({title:void 0,url:void 0}),{navigate:R,navigationHistory:O,params:S,searchParams:C,structureParams:A}=Mi({initialPreviewUrl:g,routerNavigate:m,routerState:p,routerSearchParams:h,frameStateRef:j}),T=c.useMemo(()=>Mn(R,50),[R]),[q,D]=c.useReducer(kr,{},Ir),N=c.useMemo(()=>S.perspective?"published":"previewDrafts",[S.perspective]),ee=c.useMemo(()=>S.viewport?"mobile":"desktop",[S.viewport]),[B,Z]=Ei(N,j),yt=Ar(),bt=Mr(),Nn=Ti({navigate:R,navigationHistory:O,path:S.preview,previewUrl:(Rt=a.options)==null?void 0:Rt.previewUrl,resolvers:(kt=(Tt=a.options)==null?void 0:Tt.resolve)==null?void 0:kt.mainDocuments}),[Re,xt]=qe(),[de,Wn]=qe(),[Te,wt]=qe(),[ke,qn]=c.useState(()=>new Set),Vn=c.useCallback(_=>{const k=window.open(_,"_blank");k&&qn(I=>new Set(I).add(k))},[]),St=q.iframe.status==="loading";c.useEffect(()=>{var I;const _=(I=P.current)==null?void 0:I.contentWindow;if(!_||St)return;const k=Is({targetOrigin:w});return k.addTarget(_),x(k),()=>{k.destroy(),x(void 0)}},[w,St]),c.useEffect(()=>{const _=[];if(ke.size&&y)for(const k of ke)k&&"closed"in k&&!k.closed&&_.push(y.addTarget(k));return()=>{_.forEach(k=>k())}},[y,ke]),c.useEffect(()=>{if(!y)return;const _=y.createConnection({name:"presentation",heartbeat:!0,connectTo:"visual-editing"},we().provide({actors:Be()}));_.on("visual-editing/focus",I=>{"id"in I&&T({type:I.type,id:I.id,path:I.path})}),_.on("visual-editing/navigate",I=>{const{title:rr,url:Ae}=I;j.current.url!==Ae&&T({},{preview:Ae}),j.current={title:rr,url:Ae}}),_.on("visual-editing/meta",I=>{j.current.title=I.title}),_.on("visual-editing/toggle",I=>{D({type:Or,enabled:I.enabled})}),_.on("visual-editing/documents",I=>{Z("visual-editing",I.perspective,I.documents)}),_.on("visual-editing/refreshing",I=>{I.source==="manual"?clearTimeout(jt.current):I.source==="mutation"&&D({type:Mt})}),_.on("visual-editing/refreshed",()=>{D({type:mn})}),_.onStatus(xt);const k=_.start();return E(_),()=>{k(),E(null)}},[y,T,Z,xt,w]),c.useEffect(()=>{if(!y)return;const _=y.createConnection({name:"presentation",connectTo:"preview-kit",heartbeat:!0},we().provide({actors:Be()}));return _.onStatus(wt),_.on("preview-kit/documents",k=>{k.projectId===yt&&k.dataset===bt&&Z("preview-kit",k.perspective,k.documents)}),_.start()},[y,bt,yt,Z,wt,w]);const Fn=c.useCallback(_=>{T({path:_n.toString(_)},{},!0)},[T]),Kn=c.useCallback(_=>{const k=new URL(_,g.origin),I=k.pathname+k.search;k.origin===g.origin&&I!==S.preview&&T({},{preview:I})},[g,S,T]),Hn=c.useCallback(_=>{T({},_)},[T]);c.useEffect(()=>{S.id&&S.path?f==null||f.post({type:"presentation/focus",data:{id:S.id,path:S.path}}):f==null||f.post({type:"presentation/blur",data:void 0})},[S.id,S.path,f]),c.useEffect(()=>{j.current.url&&S.preview&&j.current.url!==S.preview&&(j.current.url=S.preview,Re!=="connected"&&P.current?P.current.src=`${w}${S.preview}`:f==null||f.post({type:"presentation/navigate",data:{url:S.preview,type:"replace"}}))},[Re,w,S.preview,f]);const se=c.useCallback(()=>f==null?void 0:f.post({type:"presentation/toggle-overlay",data:void 0}),[f]),[Bn,Gn]=c.useState(null);c.useEffect(()=>{const _=I=>{Kt(I)&&se()},k=I=>{Kt(I)&&se(),xa(["mod","\\"],I)&&se()};return window.addEventListener("keydown",k),window.addEventListener("keyup",_),()=>{window.removeEventListener("keydown",k),window.removeEventListener("keyup",_)}},[se]);const[Xn,Jn]=c.useState(null),[{navigatorEnabled:Pt,toggleNavigator:Qn},Yn]=ti({unstable_navigator:d}),Ie=c.useRef(S.id);c.useEffect(()=>{S.rev&&Ie.current&&S.id!==Ie.current&&T({},{rev:void 0}),Ie.current=S.id});const jt=c.useRef(),Zn=c.useCallback(_=>{if(D({type:Mt}),f){jt.current=window.setTimeout(_,300),f.post({type:"presentation/refresh",data:{source:"manual",livePreviewEnabled:Te==="connected"||de==="connected"}});return}_()},[de,Te,f]),Et=Dr(),er=c.useCallback(({id:_,type:k,path:I})=>{if(j.current.url)return{title:j.current.title||j.current.url,name:"edit",params:{id:_,path:I,type:k,inspect:$r,workspace:Et.name,mode:zr,preview:S.preview}}},[S.preview,Et.name]),tr=c.useCallback(_=>{T({},{viewport:_==="desktop"?void 0:"mobile"},!0)},[T]),nr=c.useCallback(_=>{T({},{perspective:_==="previewDrafts"?void 0:_})},[T]);return i.jsxs(i.Fragment,{children:[i.jsx(ai,{devMode:b,name:u,navigate:T,params:S,searchParams:C,structureParams:A,children:i.jsx(Za,{navigate:T,children:i.jsx(si,{params:S,children:i.jsx(wa,{comlink:f,children:i.jsx(Ki,{height:"fill",children:i.jsxs(Ta,{children:[i.jsx(Yn,{}),i.jsx(gt,{id:"preview",minWidth:325,defaultSize:Pt?50:75,order:3,children:i.jsx($,{direction:"column",flex:1,height:"fill",ref:Jn,children:i.jsx(Lr,{element:Xn,children:i.jsx(Ln,{canSharePreviewAccess:v,canToggleSharePreviewAccess:n,canUseSharedPreviewAccess:r,dispatch:D,header:l,iframe:q.iframe,initialUrl:g,loadersConnection:de,navigatorEnabled:Pt,onPathChange:Kn,onRefresh:Zn,openPopup:Vn,overlaysConnection:Re,previewUrl:S.preview,perspective:N,ref:P,setPerspective:nr,setViewport:tr,targetOrigin:w,toggleNavigator:Qn,toggleOverlay:se,viewport:ee,visualEditing:q.visualEditing})})})}),i.jsx(Ya,{documentId:S.id,documentsOnPage:B,documentType:S.type,getCommentIntent:er,mainDocumentState:Nn,onFocusPath:Fn,onStructureParams:Hn,searchParams:C,setDisplayedDocument:Gn,structureParams:A})]})})})})})}),y&&i.jsx(c.Suspense,{children:i.jsx(Li,{controller:y,perspective:N,liveDocument:Bn,onDocumentsOnPage:Z,onLoadersConnection:Wn,documentsOnPage:B})}),f&&S.id&&S.type&&i.jsx(c.Suspense,{children:i.jsx(Wi,{comlink:f,id:S.id,type:S.type,loadersConnection:de,previewKitConnection:Te})}),f&&i.jsx(c.Suspense,{children:i.jsx(Fi,{comlink:f,perspective:N})}),f&&B.length>0&&i.jsx(c.Suspense,{children:i.jsx(Vi,{comlink:f,perspective:N,refs:B})}),f&&i.jsx(c.Suspense,{children:i.jsx(Ui,{comlink:f})}),f&&i.jsx(c.Suspense,{children:i.jsx(Ni,{comlink:f})}),f&&i.jsx(c.Suspense,{children:i.jsx(qi,{comlink:f,perspective:N})}),S.id&&S.type&&i.jsx(ji,{documentId:S.id,documentRevision:S.rev,documentType:S.type,navigate:T,perspective:N})]})}function Bi(e){const{t}=K(H),{previewUrl:n}=e.tool.options??{},{push:r}=un(),a=typeof n=="object"||typeof n=="function",s=Cr(),[o,u]=c.useState(null),[d,l]=c.useState(null),[m,p]=c.useState(null),[h,g]=c.useState(null);c.useEffect(()=>{if(!a)return;const b=s.checkDocumentPermission("create",{_id:Y,_type:ne}).subscribe(u),w=s.checkDocumentPermission("update",{_id:Y,_type:ne}).subscribe(l),P=s.checkDocumentPermission("read",{_id:Y,_type:ne}).subscribe(p),y=s.checkDocumentPermission("create",{_id:`drafts.${on()}`,_type:lt}).subscribe(g);return()=>{b.unsubscribe(),w.unsubscribe(),P.unsubscribe(),y.unsubscribe()}},[s,a]);const v=h==null?void 0:h.granted;return c.useEffect(()=>{if(!a||v!==!1)return;const b=requestAnimationFrame(()=>r({closable:!0,status:"error",duration:3e4,title:t("preview-url-secret.missing-grants")}));return()=>cancelAnimationFrame(b)},[v,r,t,a]),a&&(!o||typeof o.granted>"u"||!d||typeof d.granted>"u"||!h||!m||typeof m.granted>"u"||typeof h.granted>"u")?i.jsx(gn,{}):i.jsx(Hi,{...e,canCreateUrlPreviewSecrets:v===!0,canToggleSharePreviewAccess:(o==null?void 0:o.granted)===!0&&(d==null?void 0:d.granted)===!0,canUseSharedPreviewAccess:(m==null?void 0:m.granted)===!0})}var Gi=Object.freeze({__proto__:null,default:Bi});const eo=Object.freeze(Object.defineProperty({__proto__:null,PresentationToolGrantsCheck:Gi,createCompatibilityActors:Be,getQueryCacheKey:ya},Symbol.toStringTag,{value:"Module"}));export{Nt as D,eo as P,Be as a,Qi as b,we as c,Os as d,ya as g,Yi as p,Zi as r,Ds as t,ie as w};
